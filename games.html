<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinny's Palace: Games & Shit</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for a clean, modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base CSS Variables for Theming - MUST BE IDENTICAL TO index.html */
        :root {
            --primary-bg: #1a202c;
            --secondary-bg: #2d3748;
            --tertiary-bg: #4a5568; /* For inputs/darker elements */
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --accent-color: #63b3ed; /* Default blue accent */
            --button-bg: #4299e1;
            --button-text: #ffffff;
            --button-hover-bg: #3182ce;
            --border-color: #4a5568;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --modal-bg: #2d3748;
            --modal-border: #4a5568;
            --accent-color-rgb: 99, 179, 237; /* Default RGB for pulse animation */
        }

        /* Theme Overrides (20 Themes) - MUST BE IDENTICAL TO index.html */
        /* Fire Inferno Theme (Default) */
        .theme-fire-inferno {
            --primary-bg: #1a0a0a;
            --secondary-bg: #3b0f0f;
            --tertiary-bg: #5a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #ffad87;
            --accent-color: #ff7f50; /* Coral */
            --button-bg: #e54d2e;
            --button-text: #ffffff;
            --button-hover-bg: #c23b22;
            --border-color: #ff7f50;
            --card-shadow: 0 5px 15px rgba(255, 127, 80, 0.3);
            --modal-bg: #3b0f0f;
            --modal-border: #ff7f50;
            --accent-color-rgb: 255, 127, 80;
        }

        /* Deep Ocean Theme */
        .theme-deep-ocean {
            --primary-bg: #0a1a2a;
            --secondary-bg: #1a2a3a;
            --tertiary-bg: #2a3a4a;
            --text-primary: #e0f2f7;
            --text-secondary: #a0d9ef;
            --accent-color: #4fc3f7; /* Light Blue */
            --button-bg: #2196f3;
            --button-text: #ffffff;
            --button-hover-bg: #1976d2;
            --border-color: #4fc3f7;
            --card-shadow: 0 5px 15px rgba(79, 195, 247, 0.3);
            --modal-bg: #1a2a3a;
            --modal-border: #4fc3f7;
            --accent-color-rgb: 79, 195, 247;
        }

        /* Forest Green Theme */
        .theme-forest-green {
            --primary-bg: #0a1a0a;
            --secondary-bg: #1a2a1a;
            --tertiary-bg: #2a3a2a;
            --text-primary: #e6ffe6;
            --text-secondary: #a0e6a0;
            --accent-color: #66bb6a; /* Green */
            --button-bg: #4caf50;
            --button-text: #ffffff;
            --button-hover-bg: #388e3c;
            --border-color: #66bb6a;
            --card-shadow: 0 5px 15px rgba(102, 187, 106, 0.3);
            --modal-bg: #1a2a1a;
            --modal-border: #66bb6a;
            --accent-color-rgb: 102, 187, 106;
        }

        /* Cyberpunk Glitch Theme */
        .theme-cyberpunk-glitch {
            --primary-bg: #0d001a;
            --secondary-bg: #1a0033;
            --tertiary-bg: #2a004d;
            --text-primary: #00ffff; /* Cyan */
            --text-secondary: #ff00ff; /* Magenta */
            --accent-color: #00ffff;
            --button-bg: #ff00ff;
            --button-text: #0d001a;
            --button-hover-bg: #e600e6;
            --border-color: #00ffff;
            --card-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
            --modal-bg: #1a0033;
            --modal-border: #00ffff;
            --accent-color-rgb: 0, 255, 255;
        }

        /* Arctic Frost Theme */
        .theme-arctic-frost {
            --primary-bg: #0f1c2c;
            --secondary-bg: #1c2c3c;
            --tertiary-bg: #2c3c4c;
            --text-primary: #e0f7fa;
            --text-secondary: #b2ebf2;
            --accent-color: #80deea; /* Cyan Light */
            --button-bg: #00bcd4;
            --button-text: #ffffff;
            --button-hover-bg: #00838f;
            --border-color: #80deea;
            --card-shadow: 0 5px 15px rgba(128, 222, 234, 0.3);
            --modal-bg: #1c2c3c;
            --modal-border: #80deea;
            --accent-color-rgb: 128, 222, 234;
        }

        /* Solar Flare Theme */
        .theme-solar-flare {
            --primary-bg: #2a0a0a;
            --secondary-bg: #3a1a0a;
            --tertiary-bg: #4a2a0a;
            --text-primary: #fff8e1;
            --text-secondary: #ffe082;
            --accent-color: #ffb300; /* Amber */
            --button-bg: #ff8f00;
            --button-text: #ffffff;
            --button-hover-bg: #e65100;
            --border-color: #ffb300;
            --card-shadow: 0 5px 15px rgba(255, 179, 0, 0.3);
            --modal-bg: #3a1a0a;
            --modal-border: #ffb300;
            --accent-color-rgb: 255, 179, 0;
        }

        /* Twilight Purple Theme */
        .theme-twilight-purple {
            --primary-bg: #1a0a2a;
            --secondary-bg: #2a1a3a;
            --tertiary-bg: #3a2a4a;
            --text-primary: #f3e5f5;
            --text-secondary: #ce93d8;
            --accent-color: #ab47bc; /* Purple */
            --button-bg: #8e24aa;
            --button-text: #ffffff;
            --button-hover-bg: #6a1b9a;
            --border-color: #ab47bc;
            --card-shadow: 0 5px 15px rgba(171, 71, 188, 0.3);
            --modal-bg: #2a1a3a;
            --modal-border: #ab47bc;
            --accent-color-rgb: 171, 71, 188;
        }

        /* Desert Sunset Theme */
        .theme-desert-sunset {
            --primary-bg: #2a1a0a;
            --secondary-bg: #3a2a0a;
            --tertiary-bg: #4a3a0a;
            --text-primary: #fffde7;
            --text-secondary: #fff59d;
            --accent-color: #ffc107; /* Amber */
            --button-bg: #ff9800;
            --button-text: #3a2a0a;
            --button-hover-bg: #fb8c00;
            --border-color: #ffc107;
            --card-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
            --modal-bg: #3a2a0a;
            --modal-border: #ffc107;
            --accent-color-rgb: 255, 193, 7;
        }

        /* Vaporwave Dreams Theme */
        .theme-vaporwave-dreams {
            --primary-bg: #0a0a2a;
            --secondary-bg: #1a0a3a;
            --tertiary-bg: #2a0a4a;
            --text-primary: #e0f7fa;
            --text-secondary: #f06292;
            --accent-color: #80cbc4; /* Teal */
            --button-bg: #4dd0e1;
            --button-text: #1a0a3a;
            --button-hover-bg: #26c6da;
            --border-color: #f06292;
            --card-shadow: 0 5px 15px rgba(128, 203, 196, 0.4);
            --modal-bg: #1a0a3a;
            --modal-border: #f06292;
            --accent-color-rgb: 128, 203, 196;
        }

        /* Emerald City Theme */
        .theme-emerald-city {
            --primary-bg: #0a2a1a;
            --secondary-bg: #1a3a2a;
            --tertiary-bg: #2a4a3a;
            --text-primary: #e8f5e9;
            --text-secondary: #a5d6a7;
            --accent-color: #4caf50; /* Green */
            --button-bg: #388e3c;
            --button-text: #ffffff;
            --button-hover-bg: #2e7d32;
            --border-color: #4caf50;
            --card-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
            --modal-bg: #1a3a2a;
            --modal-border: #4caf50;
            --accent-color-rgb: 76, 175, 80;
        }

        /* Ruby Red Theme */
        .theme-ruby-red {
            --primary-bg: #2a0a0a;
            --secondary-bg: #3a0a0a;
            --tertiary-bg: #4a0a0a;
            --text-primary: #ffebee;
            --text-secondary: #ef9a9a;
            --accent-color: #ef5350; /* Red */
            --button-bg: #d32f2f;
            --button-text: #ffffff;
            --button-hover-bg: #c62828;
            --border-color: #ef5350;
            --card-shadow: 0 5px 15px rgba(239, 83, 80, 0.3);
            --modal-bg: #3a0a0a;
            --modal-border: #ef5350;
            --accent-color-rgb: 239, 83, 80;
        }

        /* Golden Hour Theme */
        .theme-golden-hour {
            --primary-bg: #fffde7;
            --secondary-bg: #fff9c4;
            --tertiary-bg: #fff59d;
            --text-primary: #212121;
            --text-secondary: #757575;
            --accent-color: #ffeb3b; /* Yellow */
            --button-bg: #ffc107;
            --button-text: #212121;
            --button-hover-bg: #ffb300;
            --border-color: #ffeb3b;
            --card-shadow: 0 5px 15px rgba(255, 235, 59, 0.3);
            --modal-bg: #fff9c4;
            --modal-border: #ffeb3b;
            --accent-color-rgb: 255, 235, 59;
        }

        /* Midnight Blue Theme */
        .theme-midnight-blue {
            --primary-bg: #0a0a1a;
            --secondary-bg: #1a1a2a;
            --tertiary-bg: #2a2a3a;
            --text-primary: #e3f2fd;
            --text-secondary: #90caf9;
            --accent-color: #42a5f5; /* Blue */
            --button-bg: #1e88e5;
            --button-text: #ffffff;
            --button-hover-bg: #1565c0;
            --border-color: #42a5f5;
            --card-shadow: 0 5px 15px rgba(66, 165, 245, 0.3);
            --modal-bg: #1a1a2a;
            --modal-border: #42a5f5;
            --accent-color-rgb: 66, 165, 245;
        }

        /* Grayscale Modern Theme */
        .theme-grayscale-modern {
            --primary-bg: #212121;
            --secondary-bg: #424242;
            --tertiary-bg: #616161;
            --text-primary: #f5f5f5;
            --text-secondary: #bdbdbd;
            --accent-color: #9e9e9e; /* Gray */
            --button-bg: #757575;
            --button-text: #ffffff;
            --button-hover-bg: #616161;
            --border-color: #9e9e9e;
            --card-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            --modal-bg: #424242;
            --modal-border: #9e9e9e;
            --accent-color-rgb: 158, 158, 158;
        }

        /* Candy Pop Theme */
        .theme-candy-pop {
            --primary-bg: #ffebee;
            --secondary-bg: #f8bbd0;
            --tertiary-bg: #f48fb1;
            --text-primary: #424242;
            --text-secondary: #880e4f;
            --accent-color: #e91e63; /* Pink */
            --button-bg: #ec407a;
            --button-text: #ffffff;
            --button-hover-bg: #d81b60;
            --border-color: #e91e63;
            --card-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
            --modal-bg: #f8bbd0;
            --modal-border: #e91e63;
            --accent-color-rgb: 233, 30, 99;
        }

        /* Steampunk Brass Theme */
        .theme-steampunk-brass {
            --primary-bg: #2e1a0a;
            --secondary-bg: #4e2a0a;
            --tertiary-bg: #6e3a0a;
            --text-primary: #f5f5dc; /* Beige */
            --text-secondary: #d4ac0d; /* Golden */
            --accent-color: #b8860b; /* Dark Goldenrod */
            --button-bg: #a0522d;
            --button-text: #f5f5dc;
            --button-hover-bg: #8b4513;
            --border-color: #b8860b;
            --card-shadow: 0 5px 15px rgba(184, 134, 11, 0.3);
            --modal-bg: #4e2a0a;
            --modal-border: #b8860b;
            --accent-color-rgb: 184, 134, 11;
        }

        /* Neon Glow Theme */
        .theme-neon-glow {
            --primary-bg: #000000;
            --secondary-bg: #1a001a;
            --tertiary-bg: #2a002a;
            --text-primary: #00ff00; /* Green Neon */
            --text-secondary: #ff00ff; /* Magenta Neon */
            --accent-color: #00ffff; /* Cyan Neon */
            --button-bg: #ff00ff;
            --button-text: #000000;
            --button-hover-bg: #e600e6;
            --border-color: #00ff00;
            --card-shadow: 0 5px 20px rgba(0, 255, 0, 0.6);
            --modal-bg: #1a001a;
            --modal-border: #00ff00;
            --accent-color-rgb: 0, 255, 255;
        }

        /* Retro Arcade Theme */
        .theme-retro-arcade {
            --primary-bg: #0a0a2a;
            --secondary-bg: #1a0a3a;
            --tertiary-bg: #2a0a4a;
            --text-primary: #ffee58; /* Yellow */
            --text-secondary: #4dd0e1; /* Cyan */
            --accent-color: #ff4081; /* Pink Accent */
            --button-bg: #ff1744;
            --button-text: #ffffff;
            --button-hover-bg: #d50000;
            --border-color: #ffee58;
            --card-shadow: 0 5px 15px rgba(255, 64, 129, 0.4);
            --modal-bg: #1a0a3a;
            --modal-border: #ffee58;
            --accent-color-rgb: 255, 64, 129;
        }

        /* Space Odyssey Theme */
        .theme-space-odyssey {
            --primary-bg: #00001a;
            --secondary-bg: #0a0a2a;
            --tertiary-bg: #1a1a3a;
            --text-primary: #e0f2f7;
            --text-secondary: #b3e5fc;
            --accent-color: #2196f3; /* Blue */
            --button-bg: #1976d2;
            --button-text: #ffffff;
            --button-hover-bg: #1565c0;
            --border-color: #2196f3;
            --card-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
            --modal-bg: #0a0a2a;
            --modal-border: #2196f3;
            --accent-color-rgb: 33, 150, 243;
        }

        /* Classic Black & White Theme */
        .theme-classic-bw {
            --primary-bg: #000000;
            --secondary-bg: #1a1a1a;
            --tertiary-bg: #333333;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --accent-color: #999999;
            --button-bg: #555555;
            --button-text: #ffffff;
            --button-hover-bg: #444444;
            --border-color: #777777;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            --modal-bg: #1a1a1a;
            --modal-border: #777777;
            --accent-color-rgb: 153, 153, 153;
        }

        /* Ocean Sunset Theme */
        .theme-ocean-sunset {
            --primary-bg: #0a1a2a;
            --secondary-bg: #1a2a3a;
            --tertiary-bg: #2a3a4a;
            --text-primary: #ffe0b2;
            --text-secondary: #ffcc80;
            --accent-color: #ff9800; /* Orange */
            --button-bg: #ff5722;
            --button-text: #ffffff;
            --button-hover-bg: #e64a19;
            --border-color: #ff9800;
            --card-shadow: 0 5px 15px rgba(255, 87, 34, 0.3);
            --modal-bg: #1a2a3a;
            --modal-border: #ff9800;
            --accent-color-rgb: 255, 87, 34;
        }

        /* Sakura Bloom Theme */
        .theme-sakura-bloom {
            --primary-bg: #fff0f5;
            --secondary-bg: #fce4ec;
            --tertiary-bg: #f8bbd0;
            --text-primary: #4a148c;
            --text-secondary: #880e4f;
            --accent-color: #e91e63; /* Pink */
            --button-bg: #f06292;
            --button-text: #ffffff;
            --button-hover-bg: #ec407a;
            --border-color: #e91e63;
            --card-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
            --modal-bg: #fce4ec;
            --modal-border: #e91e63;
            --accent-color-rgb: 233, 30, 99;
        }

        /* Earthy Tones Theme */
        .theme-earthy-tones {
            --primary-bg: #2e2e2e;
            --secondary-bg: #3e3e3e;
            --tertiary-bg: #4e4e4e;
            --text-primary: #f5f5dc;
            --text-secondary: #d2b48c;
            --accent-color: #8b4513; /* SaddleBrown */
            --button-bg: #a0522d;
            --button-text: #f5f5dc;
            --button-hover-bg: #8b4513;
            --border-color: #8b4513;
            --card-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
            --modal-bg: #3e3e3e;
            --modal-border: #8b4513;
            --accent-color-rgb: 139, 69, 19;
        }

        /* Custom styles to ensure Inter font is applied and for smooth transitions */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.5s ease, color 0.5s ease;
            background-color: var(--primary-bg);
            color: var(--text-primary);
        }

        /* Apply theme variables to Tailwind classes */
        .bg-gray-900 { background-color: var(--primary-bg); }
        .bg-gray-800 { background-color: var(--secondary-bg); }
        .bg-gray-700 { background-color: var(--tertiary-bg); }
        .text-gray-100 { color: var(--text-primary); }
        .text-gray-300 { color: var(--text-secondary); }
        .text-gray-400 { color: var(--text-secondary); }
        .border-gray-700 { border-color: var(--border-color); }

        /* Specific element styling using variables */
        .nav-link, .icon-link {
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }
        .nav-link:hover, .icon-link:hover {
            color: var(--text-primary);
        }

        .search-input {
            background-color: var(--tertiary-bg);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        .search-input::placeholder {
            color: var(--text-secondary);
        }
        .search-icon {
            color: var(--text-secondary);
        }

        .hero-title {
            color: var(--text-primary);
        }
        .hero-subtitle {
            color: var(--text-secondary);
        }
        .accent-text {
            color: var(--accent-color);
        }

        .cta-button {
            background-color: var(--button-bg);
            color: var(--button-text);
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .cta-button:hover {
            background-color: var(--button-hover-bg);
            transform: scale(1.05);
        }

        .card {
            background-color: var(--secondary-bg);
            border-color: var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--card-shadow);
        }
        .card-icon-bg {
            background-color: var(--accent-color); /* Use accent for card icons */
        }
        .card-title {
            color: var(--text-primary);
        }
        .card-description {
            color: var(--text-secondary);
        }

        /* Central Icon Animation */
        @keyframes pulse-slow {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 15px rgba(var(--accent-color-rgb), 0.7);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 30px rgba(var(--accent-color-rgb), 1);
            }
        }
        .animate-pulse-slow {
            animation: pulse-slow 4s infinite ease-in-out;
        }

        /* Theme Editor Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: var(--modal-bg);
            color: var(--text-primary);
            border: 2px solid var(--modal-border);
            border-radius: 1rem; /* rounded-2xl */
            padding: 2rem; /* p-8 */
            max-width: 96rem; /* max-w-4xl */
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); /* shadow-2xl */
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .modal-overlay.open .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .theme-card {
            border: 2px solid transparent;
            transition: border-color 0.2s ease, transform 0.2s ease;
            background-color: var(--secondary-bg); /* Use current theme's secondary bg for preview cards */
        }
        .theme-card.active {
            border-color: var(--accent-color); /* Highlight active theme */
        }
        .theme-card:hover {
            transform: scale(1.03);
            cursor: pointer;
        }
        .theme-preview-box {
            height: 6rem; /* h-24 */
            border-radius: 0.5rem; /* rounded-lg */
            margin-bottom: 0.75rem; /* mb-3 */
            border: 1px solid var(--border-color); /* Use current theme's border for preview */
        }
        .theme-preview-box.active-border {
             border-color: var(--accent-color);
        }

        /* Dynamic background for actual theme preview boxes */
        .preview-fire-inferno { background: linear-gradient(to bottom right, #3b0f0f, #e54d2e, #ff7f50); }
        .preview-deep-ocean { background: linear-gradient(to bottom right, #1a2a3a, #2196f3, #4fc3f7); }
        .preview-forest-green { background: linear-gradient(to bottom right, #1a2a1a, #4caf50, #66bb6a); }
        .preview-cyberpunk-glitch { background: linear-gradient(to bottom right, #1a0033, #ff00ff, #00ffff); }
        .preview-arctic-frost { background: linear-gradient(to bottom right, #1c2c3c, #00bcd4, #80deea); }
        .preview-solar-flare { background: linear-gradient(to bottom right, #3a1a0a, #ff8f00, #ffb300); }
        .preview-twilight-purple { background: linear-gradient(to bottom right, #2a1a3a, #8e24aa, #ab47bc); }
        .preview-desert-sunset { background: linear-gradient(to bottom right, #3a2a0a, #ff9800, #ffc107); }
        .preview-vaporwave-dreams { background: linear-gradient(to bottom right, #1a0a3a, #4dd0e1, #f06292); }
        .preview-emerald-city { background: linear-gradient(to bottom right, #1a3a2a, #388e3c, #4caf50); }
        .preview-ruby-red { background: linear-gradient(to bottom right, #3a0a0a, #d32f2f, #ef5350); }
        .preview-golden-hour { background: linear-gradient(to bottom right, #fff9c4, #ffc107, #ffeb3b); }
        .preview-midnight-blue { background: linear-gradient(to bottom right, #1a1a2a, #1e88e5, #42a5f5); }
        .preview-grayscale-modern { background: linear-gradient(to bottom right, #424242, #757575, #9e9e9e); }
        .preview-candy-pop { background: linear-gradient(to bottom right, #f8bbd0, #ec407a, #e91e63); }
        .preview-steampunk-brass { background: linear-gradient(to bottom right, #4e2a0a, #a0522d, #b8860b); }
        .preview-neon-glow { background: linear-gradient(to bottom right, #1a001a, #ff00ff, #00ff00); }
        .preview-retro-arcade { background: linear-gradient(to bottom right, #1a0a3a, #ff1744, #ffee58); }
        .preview-space-odyssey { background: linear-gradient(to bottom right, #0a0a2a, #1976d2, #2196f3); }
        .preview-classic-bw { background: linear-gradient(to bottom right, #1a1a1a, #555555, #999999); }
        .preview-ocean-sunset { background: linear-gradient(to bottom right, #1a2a3a, #ff5722, #ff9800); }
        .preview-sakura-bloom { background: linear-gradient(to bottom right, #fce4ec, #f06292, #e91e63); }
        .preview-earthy-tones { background: linear-gradient(to bottom right, #3e3e3e, #a0522d, #8b4513); }


        /* Background animation for body */
        @keyframes subtle-gradient-shift {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }
        body.animated-background {
            background-size: 400% 400%;
            animation: subtle-gradient-shift 20s ease infinite;
        }

        /* Specific background for the animated body (can be overridden by themes) */
        body.theme-fire-inferno.animated-background {
            background: linear-gradient(270deg, #3b0f0f, #1a0a0a, #5a1a1a);
            background-size: 400% 400%;
            animation: subtle-gradient-shift 20s ease infinite;
        }
        body.theme-deep-ocean.animated-background {
            background: linear-gradient(270deg, #1a2a3a, #0a1a2a, #2a3a4a);
            background-size: 400% 400%;
            animation: subtle-gradient-shift 20s ease infinite;
        }
        body.theme-cyberpunk-glitch.animated-background {
            background: linear-gradient(270deg, #1a0033, #0d001a, #2a004d);
            background-size: 400% 400%;
            animation: subtle-gradient-shift 20s ease infinite;
        }
        /* Add more animated background definitions for other themes if desired,
           otherwise they will use their static primary-bg */

        /* Game Specific Styles */
        .game-container {
            background-color: var(--secondary-bg);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        canvas {
            background-color: var(--tertiary-bg);
            border: 2px solid var(--border-color);
            border-radius: 0.75rem; /* rounded-xl */
            display: block;
            margin: 0 auto;
            touch-action: none; /* Prevent default touch actions like scrolling */
            box-shadow: 0 10px 20px rgba(0,0,0,0.3); /* Add depth */
        }
        .game-info {
            color: var(--text-primary);
        }
        .game-button {
            background-color: var(--button-bg);
            color: var(--button-text);
            transition: background-color 0.3s ease, transform 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: none; /* Ensure no default button border */
        }
        .game-button:hover {
            background-color: var(--button-hover-bg);
            transform: scale(1.05);
        }
        .game-over-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85); /* Darker overlay */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem;
            text-align: center;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .game-over-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .game-over-text {
            color: var(--accent-color);
            font-size: 3.5rem; /* Larger text */
            font-weight: bold;
            margin-bottom: 1rem;
            text-shadow: 0 0 15px rgba(var(--accent-color-rgb), 0.7); /* Glowing effect */
        }
        .final-score-text {
            color: var(--text-primary);
            font-size: 1.8rem; /* Larger */
            margin-bottom: 2rem;
        }
        .dpad-container {
            display: grid;
            grid-template-areas:
                ". up ."
                "left . right"
                ". down .";
            gap: 0.5rem;
            margin-top: 1rem;
            width: 150px; /* Adjust size as needed */
            height: 150px;
        }
        .dpad-button {
            background-color: var(--button-bg);
            color: var(--button-text);
            padding: 0.75rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            user-select: none; /* Prevent text selection on tap */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            transition: background-color 0.1s ease, transform 0.1s ease;
        }
        .dpad-button:active {
            background-color: var(--button-hover-bg);
            transform: scale(0.95);
        }

        /* Snake Head and Eyes Styling */
        .snake-head-color {
            fill: var(--accent-color);
        }
        .snake-eye-color {
            fill: var(--text-primary);
        }
        .snake-body-color {
            fill: var(--button-bg);
        }
        .food-color {
            fill: #FFD700; /* Gold for food */
        }

        /* Canvas background pattern (subtle dots) */
        .canvas-bg-pattern {
            background-image: radial-gradient(var(--tertiary-bg) 1px, transparent 1px);
            background-size: 20px 20px;
        }

    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center animated-background">

    <!-- Header Section -->
    <nav class="w-full bg-gray-800 p-4 flex items-center justify-between shadow-lg rounded-b-lg fixed top-0 left-0 z-20"
         style="background-color: var(--secondary-bg);">
        <div class="flex items-center space-x-4">
            <a href="index.html" class="text-2xl font-bold accent-text hover:opacity-80 transition-colors">
                Sinny's Palace
            </a>
            <span class="text-xl text-gray-400" style="color: var(--text-secondary);"> / Games & Shit</span>
        </div>
        <div class="flex items-center space-x-4">
            <!-- Theme Toggle Button -->
            <button id="themeToggle" class="p-2 rounded-full bg-gray-700 hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"
                    style="background-color: var(--tertiary-bg); color: var(--text-secondary);">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h1M3 12H2m15.325-4.275l-.707-.707M6.372 17.628l-.707.707M17.628 6.372l.707-.707M6.372 6.372l-.707-.707M12 18a6 6 0 100-12 6 6 0 000 12z"></path>
                </svg>
            </button>
        </div>
    </nav>

    <!-- Game Content -->
    <main class="flex-grow flex flex-col items-center justify-center py-16 px-4 w-full">
        <div class="game-container p-8 rounded-3xl shadow-2xl border-2 max-w-2xl w-full mx-4 text-center relative"
             style="background-color: var(--secondary-bg); border-color: var(--border-color); color: var(--text-primary);">
            <h1 class="text-4xl font-extrabold mb-6 accent-text" style="color: var(--accent-color);">
                Snake Game
            </h1>
            <p class="text-lg mb-4 text-gray-300" style="color: var(--text-secondary);">
                Use WASD/Arrow Keys or the D-Pad to control the snake. Eat the food to grow!
            </p>

            <div class="relative w-full max-w-md mx-auto aspect-square">
                <canvas id="gameCanvas" class="w-full h-full rounded-xl canvas-bg-pattern" width="400" height="400"></canvas>
                <div id="gameOverOverlay" class="game-over-overlay">
                    <p class="game-over-text">GAME OVER!</p>
                    <p class="final-score-text">Score: <span id="finalScore">0</span></p>
                    <p class="final-score-text">High Score: <span id="highScoreDisplay">0</span></p>
                    <button id="restartButton" class="game-button font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105">
                        Restart Game
                    </button>
                </div>
            </div>

            <div class="flex justify-between items-center mt-4 w-full max-w-md">
                <p class="game-info text-xl font-semibold">Score: <span id="score">0</span></p>
                <p class="game-info text-xl font-semibold hidden sm:block">High Score: <span id="highScoreDisplayBottom">0</span></p>
                <button id="pauseButton" class="game-button font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105">
                    Pause
                </button>
                <button id="startGameButton" class="game-button font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105">
                    Start Game
                </button>
            </div>

            <!-- D-Pad for Mobile/Touch Controls -->
            <div class="dpad-container mx-auto mt-6 sm:hidden"> <!-- Visible on small screens, hidden on larger -->
                <button class="dpad-button dpad-up" data-direction="up">▲</button>
                <button class="dpad-button dpad-left" data-direction="left">◀</button>
                <button class="dpad-button dpad-right" data-direction="right">▶</button>
                <button class="dpad-button dpad-down" data-direction="down">▼</button>
            </div>

        </div>
    </main>

    <!-- Custom Message Box (instead of alert) -->
    <div id="messageBoxOverlay" class="modal-overlay">
        <div class="message-box modal-content p-6 rounded-xl shadow-lg border-2 max-w-sm w-full text-center"
             style="background-color: var(--secondary-bg); border-color: var(--accent-color); color: var(--text-primary);">
            <h3 id="messageBoxTitle" class="text-xl font-bold mb-4 accent-text" style="color: var(--accent-color);"></h3>
            <p id="messageBoxText" class="mb-6 text-gray-300" style="color: var(--text-secondary);"></p>
            <button id="messageBoxCloseBtn" class="cta-button py-2 px-6 rounded-full"
                    style="background-color: var(--button-bg); color: var(--button-text);">
                OK
            </button>
        </div>
    </div>

    <!-- Theme Editor Modal (Identical to index.html) -->
    <div id="themeEditorModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-3xl font-bold mb-6 text-center accent-text" style="color: var(--accent-color);">
                Choose Your Theme
            </h2>
            <div id="themeGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Theme cards will be injected here by JavaScript -->
            </div>
            <div class="mt-8 text-center">
                <button id="closeThemeEditorBtn" class="cta-button font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105"
                        style="background-color: var(--button-bg); color: var(--button-text);">
                    Close Theme Editor
                </button>
            </div>
        </div>
    </div>

    <script>
        // Define the themes in JavaScript for easy iteration - MUST BE IDENTICAL TO index.html
        const themes = [
            { name: "Fire Inferno", className: "theme-fire-inferno", previewGradient: "linear-gradient(to bottom right, #3b0f0f, #e54d2e, #ff7f50)", accentRgb: "255, 127, 80" },
            { name: "Deep Ocean", className: "theme-deep-ocean", previewGradient: "linear-gradient(to bottom right, #1a2a3a, #2196f3, #4fc3f7)", accentRgb: "79, 195, 247" },
            { name: "Forest Green", className: "theme-forest-green", previewGradient: "linear-gradient(to bottom right, #1a2a1a, #4caf50, #66bb6a)", accentRgb: "102, 187, 106" },
            { name: "Cyberpunk Glitch", className: "theme-cyberpunk-glitch", previewGradient: "linear-gradient(to bottom right, #1a0033, #ff00ff, #00ffff)", accentRgb: "0, 255, 255" },
            { name: "Arctic Frost", className: "theme-arctic-frost", previewGradient: "linear-gradient(to bottom right, #1c2c3c, #00bcd4, #80deea)", accentRgb: "128, 222, 234" },
            { name: "Solar Flare", className: "theme-solar-flare", previewGradient: "linear-gradient(to bottom right, #3a1a0a, #ff8f00, #ffb300)", accentRgb: "255, 179, 0" },
            { name: "Twilight Purple", className: "theme-twilight-purple", previewGradient: "linear-gradient(to bottom right, #2a1a3a, #8e24aa, #ab47bc)", accentRgb: "171, 71, 188" },
            { name: "Desert Sunset", className: "theme-desert-sunset", previewGradient: "linear-gradient(to bottom right, #3a2a0a, #ff9800, #ffc107)", accentRgb: "255, 193, 7" },
            { name: "Vaporwave Dreams", className: "theme-vaporwave-dreams", previewGradient: "linear-gradient(to bottom right, #1a0a3a, #4dd0e1, #f06292)", accentRgb: "128, 203, 196" },
            { name: "Emerald City", className: "theme-emerald-city", previewGradient: "linear-gradient(to bottom right, #1a3a2a, #388e3c, #4caf50)", accentRgb: "76, 175, 80" },
            { name: "Ruby Red", className: "theme-ruby-red", previewGradient: "linear-gradient(to bottom right, #3a0a0a, #d32f2f, #ef5350)", accentRgb: "239, 83, 80" },
            { name: "Golden Hour", className: "theme-golden-hour", previewGradient: "linear-gradient(to bottom right, #fff9c4, #ffc107, #ffeb3b)", accentRgb: "255, 235, 59" },
            { name: "Midnight Blue", className: "theme-midnight-blue", previewGradient: "linear-gradient(to bottom right, #1a1a2a, #1e88e5, #42a5f5)", accentRgb: "66, 165, 245" },
            { name: "Grayscale Modern", className: "theme-grayscale-modern", previewGradient: "linear-gradient(to bottom right, #424242, #757575, #9e9e9e)", accentRgb: "158, 158, 158" },
            { name: "Candy Pop", className: "theme-candy-pop", previewGradient: "linear-gradient(to bottom right, #f8bbd0, #ec407a, #e91e63)", accentRgb: "233, 30, 99" },
            { name: "Steampunk Brass", className: "theme-steampunk-brass", previewGradient: "linear-gradient(to bottom right, #4e2a0a, #a0522d, #b8860b)", accentRgb: "184, 134, 11" },
            { name: "Neon Glow", className: "theme-neon-glow", previewGradient: "linear-gradient(to bottom right, #1a001a, #ff00ff, #00ff00)", accentRgb: "0, 255, 255" },
            { name: "Retro Arcade", className: "theme-retro-arcade", previewGradient: "linear-gradient(to bottom right, #1a0a3a, #ff1744, #ffee58)", accentRgb: "255, 64, 129" },
            { name: "Space Odyssey", className: "theme-space-odyssey", previewGradient: "linear-gradient(to bottom right, #0a0a2a, #1976d2, #2196f3)", accentRgb: "33, 150, 243" },
            { name: "Classic Black & White", className: "theme-classic-bw", previewGradient: "linear-gradient(to bottom right, #1a1a1a, #555555, #999999)", accentRgb: "153, 153, 153" },
            { name: "Ocean Sunset", className: "theme-ocean-sunset", previewGradient: "linear-gradient(to bottom right, #1a2a3a, #ff5722, #ff9800)", accentRgb: "255, 87, 34" },
            { name: "Sakura Bloom", className: "theme-sakura-bloom", previewGradient: "linear-gradient(to bottom right, #fce4ec, #f06292, #e91e63)", accentRgb: "233, 30, 99" },
            { name: "Earthy Tones", className: "theme-earthy-tones", previewGradient: "linear-gradient(to bottom right, #3e3e3e, #a0522d, #8b4513)", accentRgb: "139, 69, 19" },
        ];

        // Function to apply a theme - MUST BE IDENTICAL TO index.html
        function applyTheme(themeName) {
            const body = document.body;
            themes.forEach(t => body.classList.remove(t.className));
            const selectedTheme = themes.find(t => t.name === themeName);
            if (selectedTheme) {
                body.classList.add(selectedTheme.className);
                localStorage.setItem('currentTheme', themeName);
                document.documentElement.style.setProperty('--accent-color-rgb', selectedTheme.accentRgb);
            }
        }

        // Function to initialize theme on load - MUST BE IDENTICAL TO index.html
        function initializeTheme() {
            const savedTheme = localStorage.getItem('currentTheme');
            if (savedTheme) {
                applyTheme(savedTheme);
            } else {
                applyTheme(themes[0].name); // Default to Fire Inferno if no theme saved
            }
            document.body.classList.add('animated-background');
        }

        // --- Custom Message Box Logic ---
        const messageBoxOverlay = document.getElementById('messageBoxOverlay');
        const messageBoxTitle = document.getElementById('messageBoxTitle');
        const messageBoxText = document.getElementById('messageBoxText');
        const messageBoxCloseBtn = document.getElementById('messageBoxCloseBtn');

        function showMessage(title, text) {
            messageBoxTitle.textContent = title;
            messageBoxText.textContent = text;
            messageBoxOverlay.classList.add('open');
        }

        messageBoxCloseBtn.addEventListener('click', () => {
            messageBoxOverlay.classList.remove('open');
        });

        // --- Theme Editor Modal Logic (Identical to index.html) ---
        const themeEditorModal = document.getElementById('themeEditorModal');
        const themeGrid = document.getElementById('themeGrid');
        const closeThemeEditorBtn = document.getElementById('closeThemeEditorBtn');
        const openThemeEditorBtn = document.getElementById('themeToggle'); // Re-purpose the existing theme toggle button

        openThemeEditorBtn.addEventListener('click', () => {
            themeEditorModal.classList.add('open');
            renderThemeCards();
        });

        closeThemeEditorBtn.addEventListener('click', () => {
            themeEditorModal.classList.remove('open');
        });

        themeEditorModal.addEventListener('click', (e) => {
            if (e.target === themeEditorModal) {
                themeEditorModal.classList.remove('open');
            }
        });

        function renderThemeCards() {
            themeGrid.innerHTML = '';
            const currentActiveTheme = localStorage.getItem('currentTheme') || themes[0].name;

            themes.forEach(theme => {
                const themeCard = document.createElement('div');
                themeCard.className = `theme-card rounded-xl p-4 cursor-pointer transition-all duration-200 hover:scale-103 transform flex flex-col items-center justify-center text-center`;
                if (theme.name === currentActiveTheme) {
                    themeCard.classList.add('active');
                }
                themeCard.style.backgroundColor = 'var(--secondary-bg)';

                themeCard.innerHTML = `
                    <div class="w-full h-24 rounded-lg mb-3 theme-preview-box ${theme.name === currentActiveTheme ? 'active-border' : ''}" style="background: ${theme.previewGradient}; border-color: var(--border-color);"></div>
                    <h3 class="text-xl font-semibold" style="color: var(--text-primary);">${theme.name}</h3>
                    <p class="text-sm" style="color: var(--text-secondary);">${theme.name === currentActiveTheme ? 'Active' : 'Click to activate'}</p>
                `;
                themeCard.addEventListener('click', () => {
                    applyTheme(theme.name);
                    renderThemeCards();
                });
                themeGrid.appendChild(themeCard);
            });
        }

        // --- Snake Game Logic ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const finalScoreDisplay = document.getElementById('finalScore');
        const highScoreDisplay = document.getElementById('highScoreDisplay');
        const highScoreDisplayBottom = document.getElementById('highScoreDisplayBottom'); // For bottom display
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const restartButton = document.getElementById('restartButton');
        const startGameButton = document.getElementById('startGameButton');
        const pauseButton = document.getElementById('pauseButton');
        const dpadButtons = document.querySelectorAll('.dpad-button');

        const gridSize = 20; // Size of each snake segment and food item
        let tileCount = canvas.width / gridSize; // Number of tiles in a row/column

        let snake = []; // Initialized in startGame
        let food = {};
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') ? parseInt(localStorage.getItem('snakeHighScore')) : 0;
        let dx = 0; // x velocity
        let dy = 0; // y velocity
        let changingDirection = false;
        let gameIntervalId; // Use requestAnimationFrame ID
        let gameStarted = false;
        let isPaused = false;
        let gameSpeed = 150; // Initial game speed in ms (lower is faster)
        let audioContext;
        let eatSoundBuffer;
        let gameOverSoundBuffer;

        // Function to create a simple audio tone
        function playTone(frequency, duration, type, volume) {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.type = type; // 'sine', 'square', 'sawtooth', 'triangle'
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            gainNode.gain.setValueAtTime(volume, audioContext.currentTime);

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.start();
            gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + duration);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function resizeCanvas() {
            const containerWidth = canvas.parentElement.offsetWidth;
            const newCanvasSize = Math.min(containerWidth, 400); // Max 400px, but responsive
            canvas.width = newCanvasSize;
            canvas.height = newCanvasSize;
            tileCount = canvas.width / gridSize;
            // Redraw game after resize if it's active
            if (gameStarted && !isPaused && !gameOverOverlay.classList.contains('visible')) {
                drawGame();
            }
        }

        function generateFood() {
            food = {
                x: Math.floor(Math.random() * tileCount),
                y: Math.floor(Math.random() * tileCount)
            };
            // Ensure food doesn't spawn on the snake
            for (let i = 0; i < snake.length; i++) {
                if (food.x === snake[i].x && food.y === snake[i].y) {
                    generateFood(); // Recurse if food is on snake
                    return;
                }
            }
        }

        function drawSnakePart(snakePart, index) {
            const headColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-color');
            const bodyColor = getComputedStyle(document.documentElement).getPropertyValue('--button-bg');
            const borderColor = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');

            ctx.fillStyle = index === 0 ? headColor : bodyColor;
            ctx.strokeStyle = borderColor;
            ctx.beginPath();
            ctx.roundRect(snakePart.x * gridSize, snakePart.y * gridSize, gridSize, gridSize, 5); // Rounded corners
            ctx.fill();
            ctx.stroke();

            // Draw eyes for the head
            if (index === 0) {
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-primary'); // Eye color
                const eyeSize = gridSize / 5;
                const eyeOffset = gridSize / 4;

                if (dx === 1) { // Moving right
                    ctx.beginPath();
                    ctx.arc(snakePart.x * gridSize + gridSize - eyeOffset, snakePart.y * gridSize + eyeOffset, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(snakePart.x * gridSize + gridSize - eyeOffset, snakePart.y * gridSize + gridSize - eyeOffset, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                } else if (dx === -1) { // Moving left
                    ctx.beginPath();
                    ctx.arc(snakePart.x * gridSize + eyeOffset, snakePart.y * gridSize + eyeOffset, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(snakePart.x * gridSize + eyeOffset, snakePart.y * gridSize + gridSize - eyeOffset, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                } else if (dy === 1) { // Moving down
                    ctx.beginPath();
                    ctx.arc(snakePart.x * gridSize + eyeOffset, snakePart.y * gridSize + gridSize - eyeOffset, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(snakePart.x * gridSize + gridSize - eyeOffset, snakePart.y * gridSize + gridSize - eyeOffset, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                } else if (dy === -1) { // Moving up
                    ctx.beginPath();
                    ctx.arc(snakePart.x * gridSize + eyeOffset, snakePart.y * gridSize + eyeOffset, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(snakePart.x * gridSize + gridSize - eyeOffset, snakePart.y * gridSize + gridSize - eyeOffset, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        function drawFood() {
            ctx.fillStyle = '#FFD700'; // Gold color for food
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
            ctx.beginPath();
            ctx.arc((food.x * gridSize) + gridSize / 2, (food.y * gridSize) + gridSize / 2, gridSize / 2 - 2, 0, 2 * Math.PI); // Circular food
            ctx.fill();
            ctx.stroke();
        }

        function drawGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas
            drawFood();
            snake.forEach(drawSnakePart);
        }

        function advanceSnake() {
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };
            snake.unshift(head); // Add new head

            const didEatFood = head.x === food.x && head.y === food.y;
            if (didEatFood) {
                score += 10;
                scoreDisplay.textContent = score;
                playTone(440, 0.1, 'sine', 0.5); // Play eat sound
                generateFood(); // Generate new food
                // Increase speed every 50 points
                if (score % 50 === 0 && gameSpeed > 50) {
                    gameSpeed -= 10; // Decrease delay to increase speed
                }
            } else {
                snake.pop(); // Remove tail if no food eaten
            }
        }

        function checkCollision() {
            const head = snake[0];
            // Check wall collision
            const hitLeftWall = head.x < 0;
            const hitRightWall = head.x >= tileCount;
            const hitTopWall = head.y < 0;
            const hitBottomWall = head.y >= tileCount;

            if (hitLeftWall || hitRightWall || hitTopWall || hitBottomWall) {
                return true;
            }

            // Check self-collision
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return true;
                }
            }
            return false;
        }

        function changeDirection(event) {
            // Prevent multiple direction changes per game tick
            if (changingDirection) return;
            changingDirection = true;

            const keyPressed = event.key;
            const goingUp = dy === -1;
            const goingDown = dy === 1;
            const goingLeft = dx === -1;
            const goingRight = dx === 1;

            // Handle WASD and Arrow Keys
            if ((keyPressed === 'w' || keyPressed === 'W' || keyPressed === 'ArrowUp') && !goingDown) {
                dx = 0;
                dy = -1;
            } else if ((keyPressed === 's' || keyPressed === 'S' || keyPressed === 'ArrowDown') && !goingUp) {
                dx = 0;
                dy = 1;
            } else if ((keyPressed === 'a' || keyPressed === 'A' || keyPressed === 'ArrowLeft') && !goingRight) {
                dx = -1;
                dy = 0;
            } else if ((keyPressed === 'd' || keyPressed === 'D' || keyPressed === 'ArrowRight') && !goingLeft) {
                dx = 1;
                dy = 0;
            }
        }

        function mainLoop() {
            if (isPaused) {
                gameIntervalId = requestAnimationFrame(mainLoop); // Keep requesting frame to check for unpause
                return;
            }

            if (checkCollision()) {
                endGame();
                return;
            }

            changingDirection = false; // Allow direction change for next tick
            setTimeout(function() {
                advanceSnake();
                drawGame();
                gameIntervalId = requestAnimationFrame(mainLoop);
            }, gameSpeed); // Use dynamic gameSpeed
        }

        function startGame() {
            if (gameStarted) return; // Prevent starting multiple times
            gameStarted = true;
            isPaused = false;
            gameOverOverlay.classList.remove('visible'); // Hide game over overlay
            restartButton.classList.add('hidden'); // Hide restart button initially
            startGameButton.classList.add('hidden'); // Hide start button
            pauseButton.classList.remove('hidden'); // Show pause button
            
            snake = [{ x: 10, y: 10 }]; // Reset snake position
            dx = 1; // Start moving right
            dy = 0;
            score = 0;
            gameSpeed = 150; // Reset speed
            scoreDisplay.textContent = score;
            highScoreDisplay.textContent = highScore; // Update high score on game over screen
            highScoreDisplayBottom.textContent = highScore; // Update high score on main game screen
            generateFood();
            mainLoop();
        }

        function endGame() {
            cancelAnimationFrame(gameIntervalId);
            gameStarted = false;
            isPaused = false; // Ensure game is not paused when over
            finalScoreDisplay.textContent = score;

            if (score > highScore) {
                highScore = score;
                localStorage.setItem('snakeHighScore', highScore);
                highScoreDisplay.textContent = highScore;
                highScoreDisplayBottom.textContent = highScore;
            }

            gameOverOverlay.classList.add('visible'); // Show game over overlay
            restartButton.classList.remove('hidden'); // Show restart button
            pauseButton.classList.add('hidden'); // Hide pause button
            playTone(80, 0.5, 'sawtooth', 0.8); // Play game over sound
        }

        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                pauseButton.textContent = 'Resume';
                showMessage("Game Paused", "Press 'Resume' or 'P' to continue.");
            } else {
                pauseButton.textContent = 'Pause';
                messageBoxOverlay.classList.remove('open'); // Close message box if open
                mainLoop(); // Resume game loop
            }
        }

        function restartGame() {
            gameOverOverlay.classList.add('hidden');
            startGame();
        }

        function initSounds() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            // You can pre-generate simple buffers if needed for more complex sounds
            // For now, playTone is sufficient.
        }

        // Event Listeners
        document.addEventListener('keydown', (event) => {
            if (event.key === 'p' || event.key === 'P') {
                if (gameStarted && !gameOverOverlay.classList.contains('visible')) {
                    togglePause();
                }
            } else if (gameStarted && !isPaused && !gameOverOverlay.classList.contains('visible')) {
                changeDirection(event);
            }
        });
        startGameButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', restartGame);
        pauseButton.addEventListener('click', togglePause);

        // D-pad touch controls
        dpadButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                if (gameStarted && !isPaused && !gameOverOverlay.classList.contains('visible')) {
                    const direction = event.currentTarget.dataset.direction;
                    const fakeKeyEvent = { key: '' };
                    if (direction === 'up') fakeKeyEvent.key = 'w';
                    else if (direction === 'down') fakeKeyEvent.key = 's';
                    else if (direction === 'left') fakeKeyEvent.key = 'a';
                    else if (direction === 'right') fakeKeyEvent.key = 'd';
                    changeDirection(fakeKeyEvent);
                } else if (!gameStarted) {
                    startGame(); // Allow starting game with D-pad
                }
            });
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
            initSounds(); // Initialize audio context
            resizeCanvas(); // Set initial canvas size
            window.addEventListener('resize', resizeCanvas); // Make canvas responsive
            drawGame(); // Draw initial empty game state
            highScoreDisplay.textContent = highScore; // Display high score on game over screen
            highScoreDisplayBottom.textContent = highScore; // Display high score on main game screen
            pauseButton.classList.add('hidden'); // Hide pause button until game starts
        });

    </script>
</body>
</html>
